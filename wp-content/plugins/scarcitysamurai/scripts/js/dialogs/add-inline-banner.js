// Generated by CoffeeScript 1.4.0

/*

LEGAL COPYRIGHT NOTICE

Copyright (c) Noble Samurai Pty Ltd, 2008-2013. All Rights Reserved.

This software is proprietary to and embodies the confidential technology of Noble Samurai Pty Ltd.
Possession, use, dissemination or copying of this software and media is authorised only pursuant
to a valid written license from Noble Samurai Pty Ltd. Questions or requests regarding permission may
be sent by email to legal@noblesamurai.com or by post to PO Box 477, Blackburn Victoria 3130, Australia.
*/


(function() {

  jQuery(function($) {
    var ScarcitySamuraiAddInlineBannerDialog;
    return ScarcitySamuraiAddInlineBannerDialog = (function() {

      function ScarcitySamuraiAddInlineBannerDialog() {
        var _this = this;
        this.$dialog = $('#ss-add-inline-banner-dialog');
        this.campaignId = this.$dialog.data('ss-campaign-id');
        this.inWizard = this.$dialog.data('ss-in-wizard') === 1;
        this.$bannerSelect = $('.ss-banner-select', this.$dialog);
        this.$bannerShowType = $('[name="ss-inline-banner-show-type"]', this.$dialog);
        this.$bannerShowValue = $('[name="ss-inline-banner-show-value"]', this.$dialog);
        this.$bannerAction = $('[name="ss-inline-banner-action"]', this.$dialog);
        this.$bannerRedirectPageId = $('[name="ss-inline-banner-action-redirect-page-id"]', this.$dialog);
        this.$bannerRedirectURL = $('[name="ss-inline-banner-action-redirect-url"]', this.$dialog);
        this.update = null;
        this.$dialog.dialog({
          open: function() {
            var showNotice, _ref;
            showNotice = !_this.inWizard && _this.campaignId === null;
            $('.ss-dialog-notice', _this.$dialog).toggle(showNotice);
            if (((_ref = _this.update) != null ? _ref.banner_id : void 0) != null) {
              _this.$dialog.dialog('option', 'title', 'Update Inline Banner');
              _this.renameButton('Add', 'Update');
              _this.$bannerSelect.select2('val', _this.update.banner_id);
              _this.$bannerShowValue.val(_this.update.banner_show_value || 0);
              if (_this.update.banner_show_type === 'immediately') {
                _this.$bannerShowType.filter('input[value="immediately"]').click();
              } else {
                _this.$bannerShowType.filter('input[value="page_load"]').click();
              }
              if (_this.update.banner_redirect_page_id != null) {
                _this.$bannerRedirectPageId.select2('val', _this.update.banner_redirect_page_id);
                return _this.$bannerAction.filter('input[value="redirect_to_page"]').click();
              } else if (_this.update.banner_redirect_url != null) {
                _this.$bannerRedirectURL.val(_this.update.banner_redirect_url);
                return _this.$bannerAction.filter('[value="redirect_to_url"]').click();
              } else {
                return _this.$bannerAction.filter('[value="do_nothing"]').click();
              }
            } else {
              _this.resetDialog();
              _this.$dialog.dialog('option', 'title', 'Add Inline Banner');
              return _this.renameButton('Update', 'Add');
            }
          },
          close: function() {
            return _this.update = null;
          },
          autoOpen: false,
          resizable: false,
          modal: true,
          width: 700,
          buttons: {
            'Cancel': function() {
              return $(this).dialog('close');
            },
            'Add': function() {
              return _this.addInlineBanner();
            }
          }
        });
        this.createApi();
        this.createBindings();
      }

      ScarcitySamuraiAddInlineBannerDialog.prototype.addInlineBanner = function() {
        var args, _ref;
        args = {
          banner_id: this.$bannerSelect.select2('val'),
          banner_align: (_ref = this.update) != null ? _ref.banner_align : void 0,
          banner_show_type: this.$bannerShowType.filter(':checked').val()
        };
        if (args.banner_show_type === 'page_load') {
          args.banner_show_value = parseInt(this.$bannerShowValue.val(), 10);
        }
        switch (this.$bannerAction.filter(':checked').val()) {
          case 'redirect_to_page':
            args.banner_redirect_page_id = this.$bannerRedirectPageId.select2('val');
            break;
          case 'redirect_to_url':
            args.banner_redirect_url = this.$bannerRedirectURL.val();
        }
        this.$dialog.dialog('close');
        this.$dialog.trigger('add-inline-banner');
        switch (ScarcitySamuraiHelper.pageEditorMode()) {
          case 'text':
            return QTags.insertContent(ScarcitySamuraiHelper.inlineBannerHTMLComment(args));
          case 'visual':
            return tinyMCE.execCommand('ssInsertInlineBanner', false, args);
        }
      };

      ScarcitySamuraiAddInlineBannerDialog.prototype.resetDialog = function() {
        this.$bannerAction.filter('[value="do_nothing"]').click();
        this.$bannerRedirectPageId.select2('val', '');
        return this.$bannerRedirectURL.val('');
      };

      ScarcitySamuraiAddInlineBannerDialog.prototype.renameButton = function(key, newKey) {
        var buttons;
        buttons = this.$dialog.dialog('option', 'buttons');
        if (buttons[key] != null) {
          buttons[newKey] = buttons[key];
          delete buttons[key];
          return this.$dialog.dialog('option', 'buttons', buttons);
        }
      };

      ScarcitySamuraiAddInlineBannerDialog.prototype.createApi = function() {
        var _this = this;
        return _.extend(window.ssam || {}, {
          add_banner: function() {
            return _this.$dialog.dialog('open');
          },
          edit_banner: function(args) {
            _this.update = args;
            return _this.$dialog.dialog('open');
          }
        });
      };

      ScarcitySamuraiAddInlineBannerDialog.prototype.createBindings = function() {
        var _this = this;
        $('input.ul-radio').change(function() {
          if (!this.checked) {
            return;
          }
          $(this).closest('ul').find('div.ss-opts').hide();
          return $(this).closest('li').find('div.ss-opts').show();
        }).change();
        return $('#ss-add-inline-banner-button').click(function() {
          _this.$dialog.dialog('open');
          return false;
        });
      };

      new ScarcitySamuraiAddInlineBannerDialog();

      return ScarcitySamuraiAddInlineBannerDialog;

    })();
  });

}).call(this);
